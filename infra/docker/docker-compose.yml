version: "3.9"

services:
  db:
    image: mysql:8.0
    container_name: portfolio-mysql
    environment:
      MYSQL_ROOT_PASSWORD: rootpass # MySQLのrootパスワード
      MYSQL_DATABASE: portfolio # 最初に作るDB名
      MYSQL_USER: appuser # アプリ用ユーザー
      MYSQL_PASSWORD: apppass # ↑のパスワード
    ports:
      - "3306:3306" # ホストからも接続できるように開ける
    volumes:
      - ./data:/var/lib/mysql # データ永続化（コンテナ消してもDB残す）
      - ./init:/docker-entrypoint-initdb.d # 初期化SQL用フォルダ
    networks:
      - portfolio-net

  backend:
    build: ../../backend
    container_name: portfolio-backend
    environment:
      DB_DSN: "appuser:apppass@tcp(db:3306)/portfolio?parseTime=true&charset=utf8mb4"
    ports:
      - "8080:8080"
    depends_on:
      - db
    networks:
      - portfolio-net

networks:
  portfolio-net:
    driver: bridge
